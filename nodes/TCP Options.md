**TCP Options** — это дополнительные поля в заголовке TCP, которые позволяют расширить базовый функционал протокола и оптимизировать соединение под конкретные условия сети. Они являются ключевыми для современной высокопроизводительной передачи данных.

**MSS** — это максимальное количество **полезных данных** (в байтах), которое отправитель готов принять в одном TCP-сегменте. Важно: это **не** максимальный размер всего пакета (который включает IP и TCP-заголовки), а только его "полезной нагрузки".
    
- **Для чего нужно?** Чтобы избежать фрагментации пакетов на сетевом уровне (IP-фрагментации). Фрагментация неэффективна — потеря одного фрагмента приводит к необходимости пересылать весь исходный пакет.
    
- **Как работает?**
    
    1. При установлении соединения (пакеты `SYN` и `SYN-ACK`) каждая сторона сообщает свой **MSS**.
    2. Стороны выбирают **наименьшее** из предложенных значений MSS. Это гарантирует, что ни один сегмент не будет слишком большим для какого-либо участка пути между отправителем и получателем (Path MTU Discovery).
        
- **Типичное значение:** Например, в Ethernet (MTU = 1500 байт) типичный MSS составляет `1500 - 20 (IP заголовок) - 20 (TCP заголовок) = 1460` байт.
    
- **Важность для безопасности:** Злоумышленники могут использовать аномально маленький или большой MSS для обхода систем обнаружения вторжений (IDS) или фаерволов, которые не умеют правильно обрабатывать нестандартные сегменты.

 WSopt (Window Scale Option) - коэффициент масштабирования для поля **Window Size** в TCP-заголовке.
    
- **Для чего нужно?** Стандартное поле "Window Size" имеет длину 16 бит, что ограничивает максимальный размер окна значением **65 535 байт** (`2^16`). Для высокоскоростных сетей с большой задержкой (BDP - Bandwidth-Delay Product) этого недостаточно. Окно в 64 КБ при RTT=200 мс ограничивает пропускную способность канала примерно до `(65535 bytes * 8 bits) / 0.2 sec ≈ 2.62 Mbit/s`, что крайне мало для современных сетей.
    
- **Как работает?**
    
    1. При `SYN`-обмене стороны договариваются о коэффициенте масштабирования (shift count).
        
    2. Фактический размер окна вычисляется как: `Реальный размер окна = Заявленное значение Window * (2 ^ Window_Scale)`.
        
    3. Например, если получатель указал `Window=65535` и `Window_Scale=4`, то реальный размер окна будет `65535 * (2^4) = 65535 * 16 = 1 048 560 байт (~1 МБ)`.
        
- **Важность для безопасности:** Анализаторы трафика (как Wireshark) показывают уже рассчитанное "реальное" окно. Без поддержки этой опции современные сети не смогли бы эффективно использовать свою пропускную способность.

TSopt (Timestamp Option) - опция, позволяющая добавлять в каждый TCP-сегмент метки времени отправки и получения.
    
- **Для чего нужно?** Решает две критически важные задачи:
    
    1. **Точное измерение RTT (Round-Trip Time):** Отправитель помещает текущую временную метку (TSval) в каждый сегмент. Получатель echoing-ом возвращает эту метку (TSecr) в ACK. Отправитель, получая ACK, вычисляет точную задержку `Текущее_время - TSval`. Это позволяет точнее настраивать таймер ретрансмиссий (RTO).
        
    2. **Защита от переполнения порядковых номеров (PAWS - Protection Against Wrapped Sequences):** В гигабитных сетях 32-битный порядковый номер (Sequence Number) может "переполниться" (сброситься в ноль) очень быстро. Злоумышленник может подсунуть "задержанный" пакет из предыдущего цикла, приняв его за валидный. Метки времени, которые меняются гораздо быстрее, действуют как расширение порядкового номера и позволяют отличить старый пакет от нового.
        
- **Как работает?** Каждая сторона заполняет поле `TSval` своим текущим временем. В ответах она возвращает последнее полученное значение `TSval` в поле `TSecr` (echo).
    
- **Важность для безопасности:** Позволяет избежать атак с подменой "старых" пакетов, что критично для стабильности высокоскоростных соединений.

 **Где смотреть:** В развернутом виде TCP-сегмента есть секция `Options`. Там списком выводятся все опции, поддерживаемые хостами.
    
    - `Maximum segment size: 1460 bytes`
    - `Window scale: 8 (multiply by 256)`
    - `Timestamps: TSval 123456789, TSecr 0`
    - `No-Operation (NOP)`
    - `SACK permitted`