TCP Window Size, размер окна TCP — это размер буфера, используемый при приёме пакета. По сути, это объем данных, отправленных в одном пакете TCP. По умолчанию размер окна составляет не более 65535 байт. С опцией Window scale option он может достигать 1 Гб.

**Размер окна TCP (TCP Window Size)** — это ключевой параметр механизма управления потоком данных (`flow control`), который определяет, какой объем данных (в байтах) отправитель может передать, не дожидаясь подтверждения (ACK) от получателя.

Этот механизм называется **«скользящее окно» (Sliding Window)**.

**Как это работает:**

1. **Получатель** сообщает отправителю о размере своего свободного буфера в поле `Window Size` TCP-заголовка.
2. **Отправитель** может посылать данные, пока их суммарный объем не превысит заявленный размер окна.
3. По мере того как получатель обрабатывает данные из своего буфера, он отправляет **подтверждения (ACK)**, в которых указывает новый, увеличившийся размер окна.
4. Окно как бы «скользит» вперед, позволяя отправлять новые порции данных.

**Основная цель** — предотвратить переполнение буфера получателя и, как следствие, потерю пакетов. Это обеспечивает надежную и эффективную передачу данных, адаптируясь к скорости работы получателя.

**Ключевые аспекты:**

- **Динамичность**: Размер окна постоянно меняется в зависимости от загруженности получателя.
- **Нулевое окно (Zero Window)**: Если получатель сообщает окно размером 0, отправитель приостанавливает передачу данных до получения нового, ненулевого значения.
- **Масштабирование окна (Window Scaling, RFC 7323)**: Опция, позволяющая использовать окна размером более 64 КБ, что критично для высокоскоростных сетей.

Window Scale (Масштабирование окна) — это параметр протокола TCP, позволяющий увеличить максимальный размер окна приёма до 1 ГБ, вместо стандартных 65 535 байт. Используя этот параметр, устройства могут отправлять и получать больше данных за один раз, что повышает эффективность использования пропускной способности сети и увеличивает скорость передачи данных, особенно в сетях с высокой задержкой или большой пропускной способностью. 

Как это работает 

1. **Стандартное ограничение:** 
    Поле размера окна в заголовке TCP изначально имеет размер 16 бит, что ограничивает максимальный размер окна 65 535 байтами.
    
2. **Применение масштабирования:** 
    Параметр Window Scale используется для умножения 16-битного поля на коэффициент масштабирования, который согласовывается между отправляющим и принимающим узлами при установке соединения.
    
3. **Увеличение эффективности:** 
    Увеличенный размер окна позволяет отправляющей стороне отправлять больше данных, не дожидаясь подтверждения от принимающей стороны, что снижает количество "пустых" подтверждений и повышает производительность сети.
    

Когда это важно 

- **Высокоскоростные сети:** 
    Для высокоскоростных сетей, где пропускная способность превышает 65 535 байт, этот параметр позволяет использовать всю доступную полосу пропускания.
    
- **Сети с большой задержкой:** 
    В сетях с высокой задержкой (большим временем прохождения сигнала туда и обратно) увеличение размера окна позволяет передавать большой объем данных, прежде чем потребуется подтверждение, что помогает поддерживать высокую скорость.

### Почему это важно в кибербезопасности?

TCP Window Size — это не просто параметр производительности. Он является критически важным объектом для наблюдения и атак по нескольким причинам:

#### 1. Обнаружение аномалий и вторжений (IDS/IPS)

Сетевые системы обнаружения вторжений (например, Suricata, Zeek) активно анализируют размер окна.

- **Необычно маленькое окно или "нулевое окно" (Zero Window)** может быть признаком:
    
    - **Перегруженности системы:** Злоумышленник может пытаться провести DoS-атаку на приложение, вызывая его зависание.
        
    - **Атаки на исходящие соединения:** Если атакованный хост сам становится источником атаки (например, участвует в DDoS-ботнете), его ресурсы CPU и памяти перегружены, что приводит к маленькому размеру окна для легитимных соединений.
        
    - **Признак malware:** Вредоносное ПО, крадущее данные, может ненормально часто менять размер окна, пытаясь регулировать поток украденной информации.
        
- **Резкие, хаотичные изменения размера окна** могут указывать на нестабильность системы, вызванную атакой.
    

#### 2. Обход систем защиты (Evasion)

Опытные злоумышленники могут намеренно **манипулировать** размером окна, чтобы обойти механизмы безопасности.

- **Фрагментация трафика:** Разбивая вредоносный пакет на очень мелкие сегменты и используя маленький размер окна, атакующий может попытаться "спрятать" вредоносную нагрузку от простых сигнатурных анализаторов IDS, которые не умеют собирать и анализировать поток целиком.
    
- **Обход правил фаервола:** Некоторые простые правила фаервола могут блокировать пакеты по их размеру. Манипулируя окном и размером сегментов, атакующий может попытаться протолкнуть запрещенную команду или данные.
    

#### 3. Сканирование и fingerprinting (Сбор отпечатков)

Размер окна по умолчанию, его поведение и поддержка опции Window Scaling зависят от **операционной системы** и ее версии.

- Атакующий может установить соединение с целевым хостом и проанализировать, как тот управляет размером окна.
    
- Сравнив это поведение с известной базой данных (например, `p0f`), он может с высокой точностью определить, что перед ним — Windows 11, Linux 5.15.xx или старый роутер Juniper. Это критически важная информация для подбора конкретной эксплойт-атаки.
    

#### 4. Атаки на доступность (DoS)

- **Zero Window Attack:** Злоумышленник может намеренно отправлять пакеты с объявлением **нулевого размера окна**. Это заставляет отправителя (легитимный сервер) перейти в режим ожидания и приостановить передачу данных. Если атака ведется с множества IP-адресов (ботнет), это может привести к полной остановке обслуживания легитимных клиентов.
    
- **TCP Starvation:** В сочетании с другими техниками, манипуляция окном может использоваться для "голодания" TCP-соединений, не давая им получить нужную полосу пропускания.

 **Где смотреть:** В основном списке пакетов можно добавить столбец `Window size value` или `TCP Window` (он показывает значение из 16-битного поля заголовка). Однако чтобы увидеть _реальный_ масштабированный размер, нужно добавить столбец `Calculated window size` — именно он покажет `Window * 2^Scale`.
    
**Опция Window Scale:** Видна в деталях TCP-сегмента в поле `Options > Window scale: <value>`. Она присутствует только в пакетах `SYN` и `SYN-ACK` при установлении соединения.
    
**Поведение:** Вы можете наблюдать, как значение `Calculated window size` "скользит" (увеличивается и уменьшается) в пакетах `ACK` в течение сессии, что наглядно демонстрирует механизм flow control.